---
title: 'Wk 7: Working with XML, HTML and JSON in R'
author: "Dirk Hartog"
date: "2023-10-11"
output: pdf_document
---
```{r}
library(tidyverse)
library(jsonlite)
library(XML)
library(xml2)
library(stringr)
library(rvest)
```

#Pick three of your favorite books on one of your favorite subjects. At least one of the books should have more than one author. For each book, include the title, authors, and two or three other attributes that you find interesting.

## Step 1: Create three files which store the bookâ€™s information in HTML (using an html table), XML, and JSON formats and read the information form the web (in this case Github). 

**JSON file**
```{r read JSON}
# libraries used: jsonlite, dplyr, stringr 

json_url <- "https://raw.githubusercontent.com/D-hartog/DATA607/main/WK7/books.json"
json_file <- list(read_json(json_url))
books_js <- tibble(books = json_file)

books_js <- books_js %>% unnest_wider(books) %>%
  unnest_longer(books) %>%
  unnest_wider(books)

# Expand the cell with a list of two authors 

# -- Unlist that cell 
authors <- unlist(books_js$author_s[2])

# -- flatten the vector to create a string of the two authors
books_js$author_s[2] <- str_flatten(authors, ",")

# -- Use sperate rows function to separate the rows into two (one with each author)
books_js <- books_js %>% separate_rows(author_s, sep = ",")

# -- changed column names to upper case 
colnames(books_js) <- books_js %>% names() %>% str_to_upper()

# -- Trimmed white space
books_js$AUTHOR_S <- str_trim(books_js$AUTHOR_S)

books_js
```

**HTML file**
```{r read HTML}
# libraries used: rvest, dplyr, stringr

html_url <- "https://raw.githubusercontent.com/D-hartog/DATA607/main/WK7/books.html"

# -- read in the file form github
html_file <- read_html(html_url)


books_html <- html_file %>%
  html_table(fill = TRUE)

books_html <- books_html[[1]]

books_html <- books_html %>% separate_rows(author_s, sep = ",")

colnames(books_html) <- books_html %>% names() %>% str_to_upper()

books_html$AUTHOR_S <- str_trim(books_html$AUTHOR_S)

books_html
```

**XML file**
```{r read xml}
# libraries used: xml2, dplyr, stringr

xml_url <- "https://raw.githubusercontent.com/D-hartog/DATA607/main/WK7/books.xml"

xml_file <- read_xml(xml_url)

books_xml <- xml_file %>%
  xml_find_all(".//book") %>%
  as_list() %>% 
  bind_rows()

books_xml <- books_xml %>% separate_rows(author_s, sep = ",")

colnames(books_xml) <- books_xml %>% names() %>% str_to_upper()

books_xml$AUTHOR_S <- str_trim(books_xml$AUTHOR_S)

books_xml
```

